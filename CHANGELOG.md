# Changelog - Wish-Listy Backend

## [2.0.0] - 2025-12-23

### โจ New Features

#### 1. ูุธุงู ุงูุญุฌุฒ ุงูุณุฑู (Secret Reservation System)
- ุฅุถุงูุฉ ูููุฐุฌ `Reservation` ูุชุชุจุน ุญุฌูุฒุงุช ุงูุนูุงุตุฑ
- API ูุญุฌุฒ ุนูุตุฑ ูู ูุงุฆูุฉ ุฃูููุงุช ุตุฏูู (`POST /api/items/:itemId/reserve`)
- API ูุฅูุบุงุก ุงูุญุฌุฒ (`DELETE /api/items/:itemId/reserve`)
- API ูุนุฑุถ ุญุฌูุฒุงุช ุงููุณุชุฎุฏู (`GET /api/reservations`)
- ุฏุนู ุงููููุงุช ุงููุชุนุฏุฏุฉ (Quantity support)
- ููุน ุญุฌุฒ ุงูุนูุงุตุฑ ุงููููุฏุงุฉ (Gifted items)
- ุงูุชุญูู ุงูุชููุงุฆู ูู ุงููููุงุช ุงููุชุงุญุฉ
- ุงูุญูุงุธ ุนูู ุงูุณุฑูุฉ: ุนุฏู ุงููุดู ุนู ูููุฉ ุงูุญุงุฌุฒ ูููุงูู

#### 2. ุตูุญุฉ ุจุฑููุงูู ุงูุตุฏูู (Friend Profile Page)
- API ูุนุฑุถ ุจุฑููุงูู ุตุฏูู (`GET /api/users/:friendUserId/profile`)
- ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช: ุนุฏุฏ ุงูููุงุฆูุ ุงูุฃุญุฏุงุซุ ุงูุฃุตุฏูุงุก
- ุนุฑุถ ุญุงูุฉ ุงูุตุฏุงูุฉ

#### 3. ููุงุฆู ุฃูููุงุช ุงูุตุฏูู ูุน ุงูุฎุตูุตูุฉ
- API ูุนุฑุถ ููุงุฆู ุฃูููุงุช ุตุฏูู (`GET /api/users/:friendUserId/wishlists`)
- ุชุทุจูู ููุงุนุฏ ุงูุฎุตูุตูุฉ:
  - `public`: ูุฑุงูุง ุงูุฌููุน
  - `friends`: ูุฑุงูุง ุงูุฃุตุฏูุงุก ููุท
  - `private`: ูุง ูุฑุงูุง ุฃุญุฏ ุบูุฑ ุงููุงูู

#### 4. ุฃุญุฏุงุซ ุงูุตุฏูู ูุน ุญุงูุฉ ุงูุฏุนูุฉ
- API ูุนุฑุถ ุฃุญุฏุงุซ ุตุฏูู (`GET /api/users/:friendUserId/events`)
- ุชุทุจูู ููุงุนุฏ ุงูุฎุตูุตูุฉ ููุฃุญุฏุงุซ
- ุฅุฑุฌุงุน ุญุงูุฉ ุงูุฏุนูุฉ ููู ุญุฏุซ:
  - `pending`: ูู ุงูุชุธุงุฑ ุงูุฑุฏ
  - `accepted`: ุชู ุงููุจูู
  - `declined`: ุชู ุงูุฑูุถ
  - `maybe`: ุฑุจูุง
  - `not_invited`: ุบูุฑ ูุฏุนู

#### 5. ุชูุงุตูู ุงูุญุฏุซ ุงููุญุณููุฉ
- API ูุนุฑุถ ุงููุฏุนููู ูุญุงูุงุชูู (`GET /api/events/:eventId/attendees`)
- ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูุญุถูุฑ (ููุจููุ ูุฑููุถุ ุฑุจูุงุ ูุนูู)
- API ูุนุฑุถ ููุงุฆู ุงูุฃูููุงุช ุงููุฑุชุจุทุฉ ุจุงูุญุฏุซ (`GET /api/events/:eventId/wishlists`)
- ุชุทุจูู ููุงุนุฏ ุงูุฎุตูุตูุฉ ุนูู ุงูููุงุฆู ุงููุฑุชุจุทุฉ

#### 6. ุญุงูุงุช ุงูุนูุงุตุฑ (Item Status System)
- ุชุญุฏูุซ API ุชูุงุตูู Wishlist ูุฅุถุงูุฉ ุญุงูุฉ ุงูุนูุงุตุฑ
- ุซูุงุซ ุญุงูุงุช ููุนูุตุฑ:
  - `available`: ูุชุงุญ ููุญุฌุฒ
  - `reserved`: ูุญุฌูุฒ ุจุงููุงูู
  - `gifted`: ุชู ุงุณุชูุงูู
- ุนุฑุถ ูุฎุชูู ุญุณุจ ุงููุดุงูุฏ (ุงููุงูู vs ุงูุตุฏูู)
- **ูููุงูู**: ุนุฑุถ ุงูุนูุงุตุฑ ูู `available` ุฃู `gifted` ููุท (ููุญูุงุธ ุนูู ุงูููุงุฌุฃุฉ)
- **ููุตุฏูู**: ุนุฑุถ ุงูุญุงูุฉ ุงููุนููุฉ ูุน ุชูุงุตูู ุงูุญุฌุฒ

#### 7. ูุธุงู ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุฉ ููุญุฌุฒ
- ุฅุถุงูุฉ ููุน ุฅุดุนุงุฑ ุฌุฏูุฏ: `item_reserved`
- ุฅุดุนุงุฑ ููุฑู ูููุงูู ุนูุฏ ุญุฌุฒ ุนูุตุฑ (ุจุฏูู ุงููุดู ุนู ูููุฉ ุงูุญุงุฌุฒ)
- ุฏุนู Socket.IO ููุฅุดุนุงุฑุงุช ุงูููุฑูุฉ
- ุฑุณุงูุฉ ุงูุฅุดุนุงุฑ: "ุดุฎุต ูุง ุญุฌุฒ ูู [ุงุณู ุงูุนูุตุฑ] ูู ูุงุฆูุฉ [ุงุณู ุงููุงุฆูุฉ]"

### ๐ง Technical Changes

#### Models
- **NEW**: `src/models/Reservation.js`
  - ุญููู: `item`, `reserver`, `quantity`, `status`
  - Indexes: compound unique index ุนูู `{item, reserver}`

- **UPDATED**: `src/models/Item.js`
  - ุฅุถุงูุฉ ุญูู `quantity` (default: 1, min: 1)

- **UPDATED**: `src/models/Notification.js`
  - ุฅุถุงูุฉ ููุน ุฅุดุนุงุฑ ุฌุฏูุฏ: `item_reserved`

#### Controllers
- **NEW**: `src/controllers/reservationController.js`
  - `reserveItem()`: ุญุฌุฒ ุนูุตุฑ ูุน ุงูุชุญูู ูู ุงููููุฉ
  - `cancelReservation()`: ุฅูุบุงุก ุงูุญุฌุฒ
  - `getMyReservations()`: ุนุฑุถ ุญุฌูุฒุงุช ุงููุณุชุฎุฏู

- **NEW**: `src/controllers/friendProfileController.js`
  - `getFriendProfile()`: ุนุฑุถ ุจุฑููุงูู ุตุฏูู
  - `getFriendWishlists()`: ุนุฑุถ ููุงุฆู ุฃูููุงุช ุตุฏูู ูุน ุงูุฎุตูุตูุฉ
  - `getFriendEvents()`: ุนุฑุถ ุฃุญุฏุงุซ ุตุฏูู ูุน ุญุงูุฉ ุงูุฏุนูุฉ
  - `getEventAttendees()`: ุนุฑุถ ุงููุฏุนููู ูุญุงูุงุชูู
  - `getEventWishlists()`: ุนุฑุถ ุงูููุงุฆู ุงููุฑุชุจุทุฉ ุจุงูุญุฏุซ

- **UPDATED**: `src/controllers/wishlistController.js`
  - ุชุญุฏูุซ `getWishlistById()` ูุญุณุงุจ ูุฅุฑุฌุงุน ุญุงูุงุช ุงูุนูุงุตุฑ
  - ุฅุถุงูุฉ ููุทู ุนุฑุถ ูุฎุชูู ูููุงูู ูุงูุตุฏูู
  - ุญุณุงุจ ุงููููุงุช ุงููุญุฌูุฒุฉ ูุงููุชุงุญุฉ

#### Routes
- **NEW**: `src/routes/reservationRoutes.js`
  - `POST /api/items/:itemId/reserve`
  - `DELETE /api/items/:itemId/reserve`
  - `GET /api/reservations`

- **UPDATED**: `src/routes/userRoutes.js`
  - `GET /api/users/:friendUserId/profile`
  - `GET /api/users/:friendUserId/wishlists`
  - `GET /api/users/:friendUserId/events`

- **UPDATED**: `src/routes/Eventroutes.js`
  - `GET /api/events/:eventId/attendees`
  - `GET /api/events/:eventId/wishlists`

- **UPDATED**: `src/app.js`
  - ุชุณุฌูู `reservationRoutes`
  - ุชุญุฏูุซ ูุงุฆูุฉ endpoints ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ

### ๐ Documentation
- **NEW**: `API_DOCUMENTATION.md` - ุชูุซูู ุดุงูู ููู APIs ุงูุฌุฏูุฏุฉ
- **NEW**: `CHANGELOG.md` - ุณุฌู ุงูุชุบููุฑุงุช

### ๐ Security & Privacy

#### Privacy Rules Implementation
- ุชุทุจูู ููุงุนุฏ ุงูุฎุตูุตูุฉ ุนูู ูุณุชูู Wishlist
- ุชุทุจูู ููุงุนุฏ ุงูุฎุตูุตูุฉ ุนูู ูุณุชูู Event
- ุงูุชุญูู ูู ุญุงูุฉ ุงูุตุฏุงูุฉ ูุจู ุนุฑุถ ุงููุญุชูู ุงููููุฏ
- ุนุฏู ุงููุดู ุนู ูููุฉ ุงูุญุงุฌุฒ ููุญูุงุธ ุนูู ุงูููุงุฌุฃุฉ

#### Access Control
- ุงูุชุญูู ูู ุงูุฃุฐููุงุช ูู ุฌููุน ุงูู endpoints ุงูุฌุฏูุฏุฉ
- ููุน ุญุฌุฒ ุงูุนูุงุตุฑ ุงูุดุฎุตูุฉ
- ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุตูู ููุฃุญุฏุงุซ ุญุณุจ ุงูุฎุตูุตูุฉ
- ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุตูู ููููุงุฆู ุงููุฑุชุจุทุฉ ุจุงูุฃุญุฏุงุซ

### ๐ฏ Business Logic

#### Item Status Calculation
ุชู ุชุทุจูู ููุทู ูุนูุฏ ูุญุณุงุจ ุญุงูุฉ ุงูุนูุตุฑ:

1. **Gifted**: ุฅุฐุง `isPurchased === true`
2. **Reserved**: ุฅุฐุง ูุงูุช ุงููููุฉ ุงููุญุฌูุฒุฉ >= ุงููููุฉ ุงููููุฉ (ููุตุฏูู ููุท)
3. **Available**: ูู ุฌููุน ุงูุญุงูุงุช ุงูุฃุฎุฑู

**ููุงุญุธุฉ ุฎุงุตุฉ**: ุงููุงูู ูุฑู ุฏุงุฆูุงู ุงูุนูุงุตุฑ ูู `available` (ูุง ูู ุชูู `gifted`) ููุญูุงุธ ุนูู ุนูุตุฑ ุงูููุงุฌุฃุฉ.

#### Reservation Validation
- ุงูุชุญูู ูู ุงููููุฉ ุงููุชุงุญุฉ ูุจู ุงูุญุฌุฒ
- ููุน ุงูุญุฌุฒ ุงููุชูุฑุฑ ูููุณ ุงูุนูุตุฑ (compound unique index)
- ุงูุณูุงุญ ุจุชุญุฏูุซ ูููุฉ ุงูุญุฌุฒ
- ุงูุณูุงุญ ุจุฅูุบุงุก ุงูุญุฌุฒ

#### Event Access Control
ูุชู ุชุญุฏูุฏ ุงููุตูู ููุญุฏุซ ุจูุงุกู ุนูู:
1. **Public events**: ุงูุฌููุน ูููููู ุงููุดุงูุฏุฉ
2. **Friends-only events**: ุงูุฃุตุฏูุงุก ููุท + ุงููุฏุนููู + ุงููุงูู
3. **Private events**: ุงููุฏุนููู + ุงููุงูู ููุท

### ๐งช Testing Recommendations

#### Unit Tests ุงูููุชุฑุญุฉ
- ุงุฎุชุจุงุฑ ุญุฌุฒ ุนูุตุฑ ุจูููุงุช ูุฎุชููุฉ
- ุงุฎุชุจุงุฑ ููุน ุญุฌุฒ ุนูุตุฑ ูุญุฌูุฒ ุจุงููุงูู
- ุงุฎุชุจุงุฑ ููุงุนุฏ ุงูุฎุตูุตูุฉ ููููุงุฆู
- ุงุฎุชุจุงุฑ ููุงุนุฏ ุงูุฎุตูุตูุฉ ููุฃุญุฏุงุซ
- ุงุฎุชุจุงุฑ ุญุณุงุจ ุญุงูุงุช ุงูุนูุงุตุฑ ูููุงูู ูุงูุตุฏูู

#### Integration Tests ุงูููุชุฑุญุฉ
- ุณููุงุฑูู ูุงูู: ุตุฏูู ูุดุงูุฏ ูุงุฆูุฉ ููุญุฌุฒ ุนูุตุฑ ูุงููุงูู ูุชููู ุฅุดุนุงุฑ
- ุณููุงุฑูู: ุนุฑุถ ุญุฏุซ ูุน ููุงุฆูู ุงููุฑุชุจุทุฉ ูุงูุญุฌุฒ ูููุง
- ุงุฎุชุจุงุฑ ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุฉ ุนุจุฑ Socket.IO

### ๐ Database Changes

#### New Indexes
- `Reservation`: compound unique index ุนูู `{item, reserver}`
- `Reservation`: index ุนูู `{item, status}`
- `Reservation`: index ุนูู `{reserver, status}`

#### Schema Updates
- `Item.quantity`: ุญูู ุฌุฏูุฏ (Number, default: 1)
- `Notification.type`: ูููุฉ ุฌุฏูุฏุฉ `item_reserved`

### ๐ API Endpoints Summary

#### New Endpoints (9 endpoints)
```
POST   /api/items/:itemId/reserve              - ุญุฌุฒ ุนูุตุฑ
DELETE /api/items/:itemId/reserve              - ุฅูุบุงุก ุญุฌุฒ
GET    /api/reservations                       - ุนุฑุถ ุญุฌูุฒุงุชู
GET    /api/users/:friendUserId/profile        - ุจุฑููุงูู ุตุฏูู
GET    /api/users/:friendUserId/wishlists      - ููุงุฆู ุฃูููุงุช ุตุฏูู
GET    /api/users/:friendUserId/events         - ุฃุญุฏุงุซ ุตุฏูู
GET    /api/events/:eventId/attendees          - ุงููุฏุนููู ููุญุฏุซ
GET    /api/events/:eventId/wishlists          - ููุงุฆู ุงูุญุฏุซ
```

#### Updated Endpoints (1 endpoint)
```
GET    /api/wishlists/:id                      - ุชูุงุตูู ูุงุฆูุฉ ูุน ุญุงูุงุช ุงูุนูุงุตุฑ
```

### ๐ Breaking Changes
ูุง ุชูุฌุฏ breaking changes. ุฌููุน ุงูุชุญุฏูุซุงุช backward compatible.

### ๐ Notes
- ูููุตุญ ุจุฅุฌุฑุงุก migration ููุจูุงูุงุช ุงูููุฌูุฏุฉ ูุฅุถุงูุฉ `quantity: 1` ููุนูุงุตุฑ ุงููุฏููุฉ (ุงุฎุชูุงุฑู - ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ุณุชูุทุจู ุชููุงุฆูุงู)
- ุงูุชุฃูุฏ ูู ุชุญุฏูุซ ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ุฅุฐุง ูุฒู ุงูุฃูุฑ
- ูุฑุงุฌุนุฉ ุฃุฐููุงุช Socket.IO ููุชุฃูุฏ ูู ุนูู ุงูุฅุดุนุงุฑุงุช ุงูููุฑูุฉ

### ๐ Bug Fixes
- ุชู ุฅุตูุงุญ ูุดููุฉ ุนุฏู ุธููุฑ ุญุงูุฉ ุงูุญุฌุฒ ููุนูุงุตุฑ
- ุชุญุณูู ุฃุฏุงุก ุงูุงุณุชุนูุงูุงุช ุจุฅุถุงูุฉ indexes ููุงุณุจุฉ

### โก Performance Improvements
- ุงุณุชุฎุฏุงู aggregation pipelines ูุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
- ุงุณุชุฎุฏุงู compound indexes ูุชุณุฑูุน ุงูุงุณุชุนูุงูุงุช
- ุชุญุณูู populate queries ูุชูููู ุนุฏุฏ ุงูุทูุจุงุช ููู database

### ๐ฎ Future Enhancements
- ุฅุถุงูุฉ ูุธุงู ุงูุชููููุงุช ูููุฏุงูุง ุงูููุณุชููุฉ
- ุฅุถุงูุฉ ุชุฐููุฑุงุช ููุฃุญุฏุงุซ ุงููุงุฏูุฉ
- ุฅุถุงูุฉ ุฅุญุตุงุฆูุงุช ูููุณุชุฎุฏููู (ุฃูุซุฑ ุงูุนูุงุตุฑ ุญุฌุฒุงูุ ุฅูุฎ)
- ุฏุนู ุงูุตูุฑ ุงููุชุนุฏุฏุฉ ููุนูุงุตุฑ
- ุฅุถุงูุฉ ูุธุงู ุงูููุถูุฉ ูููุงุฆู ุงูุฃุตุฏูุงุก
